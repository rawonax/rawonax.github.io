---
title: "애니메이션 최적화 : flip 패턴으로 레이아웃 변화를 transform으로 바꾸기"
categories: [frontend]
date: 2025-08-31
---
어제 글에서 left/top대신에 transform 과 opacity를 쓰면 성능이 훨씬 좋아진다고 했다. 
하지만 레이아웃 자체가 변하는 상황에서는 단순히 transform으로 바꾸기 어렵다 . 
> ex: 카드 재정렬 그리드, 리스트 crud 등
이때 사용할 수 있는 방법이 FLIP패턴이다.
---
# 그래서 FLIP 패턴이 뭔데?

> first, last,  invert, play

1. first: 애니메이션 전 상태의 위치랑 크기를 기록함
2. last: 애니메이션 후 상태의 위치 크기를 기록한다
3. invert: 두 상태의 차이 (Δx, Δy, Δscale)를 transform으로 적용시킨다
4. play: transform을 0으로 되돌리면서 트랜지션을 실행한다

즉 dom의 실제 레이아웃 변경은 즉시 적용되긴 하는데 보이는 건 부드러운 transform 애니메이션이다 이말임.  

``` CSS
#grid {
  display: flex;
  flex-wrap: wrap;
  width: 200px;
}
.card {
  width: 90px;
  height: 90px;
  margin: 5px;
  background: #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s ease;
}
```
```JS
const grid = document.getElementById('grid');
const button = document.getElementById('shuffle');

button.addEventListener('click', () => {
  // 1. First
  const firstRects = Array.from(grid.children).map(el => el.getBoundingClientRect());

  // 실제 DOM 순서 변경
  [...grid.children].sort(() => Math.random() - 0.5).forEach(el => grid.appendChild(el));

  // 2. Last
  const lastRects = Array.from(grid.children).map(el => el.getBoundingClientRect());

  // 3. Invert + 4. Play
  grid.children.forEach((el, i) => {
    const dx = firstRects[i].left - lastRects[i].left;
    const dy = firstRects[i].top - lastRects[i].top;

    el.style.transform = `translate(${dx}px, ${dy}px)`;

    requestAnimationFrame(() => {
      el.style.transform = 'translate(0, 0)';
    });
  });
});
```

```html
<ul id="grid">
  <li class="card">1</li>
  <li class="card">2</li>
  <li class="card">3</li>
  <li class="card">4</li>
</ul>
<button id="shuffle">Shuffle</button>
```
대충 예제 코드는 이와 같이 적어봤다. 

## devtools로 보면 
layout은 한번만 발생해 성능 부담을 최소화시키고 
paint는 카드 추가/ 삭제 시에만 -> 이동은 gpu합성으로 처리 
프레임 드랍이 크게 줄어든다 

얘가 진짜 레이아웃 변화가 많아도 부드러운 애니메이션을 구현해주기는 하고 gpu 가속도 시켜주고 재사용까지 가능하지만 너무 많은 요소를 동시에 적용했다가는 오히려 연산이 부담될수가 있을 것 같다. 
will cahnge: transform 같은 경우에는 남발하지 말고 애니메이션 직전에만 쓰는게 좋을 것 같음. 
scale 변화까지 한번에 계산한다면 글자/이미지 렌더링이 깨지지 않도록 주의해야한다. 

# 그래서 이거 실무에 어떻게 쓰는데? 

그리드 재배치 , 드래그 앤 드롭, 카드 애니메이션등 여러가지 분야에서 썼던 것 같다 

다음글에서는 실제 프로젝트 사례 (카드리스트-> 재정렬 애니메이션)을 flip 패턴으로 최적화하는 과정을 다뤄보려고 한다. 
